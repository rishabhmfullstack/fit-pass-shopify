<section class="free-trial-section size_mobile" style="background: {{ section.settings.bg_color }}">
  <div class="main_container">
    {% render 'top-svg' %}

    <!-- Back icon (optional) -->
    <div class="top-icons">
      <span class="back-icon" id="nextArrow" style="cursor: pointer">←</span>
      <h3>{{ section.settings.topheading }}</h3>
    </div>
    <div class="free_trial_box">
      <div class="free_image">
        <img
          src="{{ section.settings.backgroundimage | img_url: 'master' }}"
          width=""
          height=""
          class="backgorund_image"
        >
      </div>

      <div class="free-header">
        <h3>{{ section.settings.heading }}</h3>
        <h2>{{ section.settings.title }}</h2>
        <p class="subtitle">{{ section.settings.subtext }}</p>
      </div>

      <div class="line-with-text">
        <p>{{ section.settings.timeline_heading }}</p>
      </div>

      <!-- Timeline Items -->
      <div class="timeline_flx">
        <div class="icon">
          <img
            src="{{ section.settings.backgorund_side | img_url: 'master' }}"
            width=""
            height=""
            class="backgorund_side"
          >
        </div>

        <div class="timeline-box">
          {% for item in section.blocks %}
            <div class="timeline-item">
              <div class="content">
                <h4>{{ item.settings.day_title }}</h4>
                <p>{{ item.settings.day_desc }}</p>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      <p class="footer-note">{{ section.settings.footer_note }}</p>

      <button class="activate-button" id="freeId">
        <span class="btn-text">
           <span class="btn-loader" style="display:none;"> {% render 'loader' %}</span>
           {{ section.settings.button_label }}
        </span>
        
      </button>
    </div>
  </div>
  <div class="bottom_Line">
    {% render 'bottomline' %}
  </div>
</section>

{% comment %} api call here {% endcomment %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const freeId = document.querySelector("#freeId");

    if (!freeId) {
      console.log("Button not found");
      return;
    }

    freeId.addEventListener("click", async () => {
      freeId.classList.add("loading");
      try {
        const response = await fetch("https://services.fitpass.dev/cred/pending-order", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-FITPASS-PAYLOAD": JSON.stringify({
              user_id: 191919193173,
              fitpass_id: 98765783,
              app_version: "8.1.2",
              device_os: "15",
              device_id: "45231",
              device_type: "android",
              device_name: "android",
              access_source: "customer-android-app",
              customer_mobile: "9212613245",
              customer_name: "Testing"
            }),
            "X-FITPASS-APP-KEY": "fhskjdhfkjsdahgkjadsfmgbasdiughdiag",
            "X-AUTH-TOKEN": "l9xGmxeF6GU4djgsMDBWG9ui0xeDhvR7qxbWq1M9"
          },
          body: JSON.stringify({
            product_type: 22,
            after_discount_price: 2199,
            total_order_price: 5330,
            membership_plan_ids: [5305],
            geo_location: { lat: 28.682875, long: 77.200337 },
            sale_discount: 3131,
            coupon_discount_details: { coupon_code: "" },
            redeemable_amount: { fitcash: 0, "e-voucher": 0 },
            fitshop_product_details: null,
            corporate_id: 0,
            user_type: 1,
            user_source: [
              { key: "campaign_name", value: "cred-subscription-offer" },
              { key: "referral_source", value: "" },
              { key: "referral_channel", value: "" }
            ],
            device_details: {
              ip: "192.168.128.130",
              app_version: "5.3.4",
              init_channel: "App",
              device_id: "491DF849-E365-42A0-AC9C-43969FDB1DA3",
              device_name: "iPhone10,3",
              device_type: "iOS",
              device_os: "15.5",
              user_agent:
                "Mozilla/5.0 (iPhone; CPU iPhone OS 15_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"
            },
            redirect_url: "/cred-special-plan-payment",
            screen_source: "",
            theme: "",
            merchant_transaction_number: "",
            merchant_order_number: ""
          })
        });

        const data = await response.json();
        console.log("API Response:", data);

        if (response.ok) {
          window.location.href = "/payment-getway";
        } else {
          alert("Something went wrong. Please try again.");
        }
      } catch (err) {
        console.error("API Error:", err);
      }
      freeId.classList.remove("loading");
    });
  });


  {% comment %} PrevArrow {% endcomment %}
   const nextArrow = document.querySelector("#nextArrow");
   nextArrow.addEventListener("click", ()=> {
    window.location.href = "/";
  })
</script>

{% schema %}
{
  "name": "Free Trial Plan Section",
  "settings": [
    {
      "type": "image_picker",
      "id": "backgroundimage",
      "label": "Success Image"
    },
    {
      "type": "image_picker",
      "id": "backgorund_side",
      "label": "Success Image"
    },
    { "type": "text", "id": "topheading", "label": "Small Heading", "default": "Your plan" },
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#f8f8f8" },
    { "type": "text", "id": "heading", "label": "Small Heading", "default": "Your plan" },
    { "type": "text", "id": "title", "label": "Main Title", "default": "7 day Free Trial" },
    { "type": "richtext", "id": "subtext", "label": "Sub Text" },
    { "type": "text", "id": "timeline_heading", "label": "Timeline Heading", "default": "WHEN WILL YOU BE CHARGED" },
    {
      "type": "text",
      "id": "footer_note",
      "label": "Bottom Note",
      "default": "₹2 will be charged to validate payment method."
    },
    { "type": "text", "id": "button_label", "label": "Button Label", "default": "Activate now" }
  ],
  "blocks": [
    {
      "type": "day_item",
      "name": "Day Item",
      "settings": [
        { "type": "text", "id": "day_title", "label": "Day Title", "default": "Today" },
        {
          "type": "textarea",
          "id": "day_desc",
          "label": "Day Description",
          "default": "Start your fitness journey with your 7-day free trial."
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Free Trial Section"
    }
  ]
}
{% endschema %}
